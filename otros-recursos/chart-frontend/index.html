<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Contenido del taller impartido para Euroavia Sevilla de C y Arduino sobre LOLIN-WeMos D1 Mini - ESP8266">
    <meta name="author" content="CieNTi">
    
    <link rel="../../img/favicon.ico">

    
    <title>Introducción - Taller de C y Arduino</title>
    

    <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hack-font@3.3.0/build/web/hack.min.css">
    <link href='//fonts.googleapis.com/css?family=PT+Sans:400,400italic,700,700italic&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="../../css/base.min.css" rel="stylesheet">
    <link href="../../css/cinder.min.css" rel="stylesheet">
    <link href="../../css/highlight.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
        <![endif]-->

    <script src="//ajax.googleapis.com/ajax/libs/webfont/1.6.28/webfont.js"></script>
    <script>
    WebFont.load({
        google: {
            families: ['Open Sans', 'PT Sans']
        }
    });
    </script>

    

     
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->

            <a class="navbar-brand" href="../..">Taller de C y Arduino</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../..">Home</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Introducción <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../introduccion/">Introducción</a>
</li>

                        
                            
<li >
    <a href="../../introduccion/carpeta-de-trabajo/">Carpeta de trabajo</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">C <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../lenguaje-c/">Lenguaje C y C99</a>
</li>

                        
                            
<li >
    <a href="../../lenguaje-c/punteros/">Punteros</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li >
                        <a href="../../hardware/">Hardware</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Arduino <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../arduino/">Introducción a Arduino</a>
</li>

                        
                            
<li >
    <a href="../../arduino/practica-01/">Práctica 1</a>
</li>

                        
                            
<li >
    <a href="../../arduino/practica-02/">Práctica 2 - El bus I2C</a>
</li>

                        
                            
<li >
    <a href="../../arduino/practica-03/">Práctica 3 - Uso de librerías</a>
</li>

                        
                            
<li >
    <a href="../../arduino/practica-04/">Práctica 4</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Otros recursos <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../">Otros recursos</a>
</li>

                        
                            
<li >
    <a href="../mqtt-broker/">MQTT Broker</a>
</li>

                        
                            
<li class="active">
    <a href="./">Introducción</a>
</li>

                        
                        </ul>
                    </li>
                
                
                </ul>

            <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                            <i class="fas fa-search"></i> Search
                        </a>
                    </li>
                    <li >
                        <a rel="next" href="../mqtt-broker/">
                            <i class="fas fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li class="disabled">
                        <a rel="prev" >
                            Next <i class="fas fa-arrow-right"></i>
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/euroavia-sevilla/curso-c-arduino/edit/master/workshop/otros-recursos/chart-frontend.md"><i class="fab fa-github"></i> Edit on GitHub</a>
                    </li>
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="first-level active"><a href="#introduccion">Introducción</a></li>
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h1 id="introduccion">Introducción</h1>
<script type="text/javascript" src="jquery-1.8.2.min.js"></script>

<script src="mqttws31-1.0.1.min.js" type="text/javascript"></script>

<script type="text/javascript"> 
    var MQTTbroker = 'iot.tesla.studio';
    var MQTTport = 1884;
    var MQTTusername = 'web_client';
    var MQTTpassword = 'SwSScKSTaVRT8yMQjiTyhbLcSlTlDkxDu6uRjZgL';
    var MQTTsubTopic = 'euroavia-pool/#'; //works with wildcard # and + topics dynamically now
    var chart; // global variuable for chart
    var dataTopics = new Array();
    //mqtt broker
    var client = new Paho.MQTT.Client(MQTTbroker, MQTTport,
          "myclientid_" + parseInt(Math.random() * 100, 10));
    client.onMessageArrived = onMessageArrived;
    client.onConnectionLost = onConnectionLost;

    //mqtt connecton options including the mqtt broker subscriptions
    var options = {
      timeout: 3,
      userName: MQTTusername,
      password: MQTTpassword,
      onSuccess: function () {
        console.log("mqtt connected");
        // Connection succeeded; subscribe to our topics
        client.subscribe(MQTTsubTopic, {qos: 1});
      },
      onFailure: function (message) {
        console.log("Connection failed, ERROR: " + message.errorMessage);
        //window.setTimeout(location.reload(),20000); //wait 20seconds before trying to connect again.
      }
    };
  //can be used to reconnect on connection lost
    function onConnectionLost(responseObject) {
      console.log("connection lost: " + responseObject.errorMessage);
      //window.setTimeout(location.reload(),20000); //wait 20seconds before trying to connect again.
    };
  //what is done when a message arrives from the broker
    function onMessageArrived(message) {
      console.log(message.destinationName, '',message.payloadString);
      //check if it is a new topic, if not add it to the array
      if (dataTopics.indexOf(message.destinationName) < 0){

          dataTopics.push(message.destinationName); //add new topic to array
          var y = dataTopics.indexOf(message.destinationName); //get the index no

          //create new data series for the chart
        var newseries = {
                  id: y,
                  name: message.destinationName,
                  data: []
                  };
        chart.addSeries(newseries); //add the series
          };

      var y = dataTopics.indexOf(message.destinationName); //get the index no of the topic from the array
      var myEpoch = new Date().getTime(); //get current epoch time
      var thenum = message.payloadString.replace( /^\D+/g, ''); //remove any text spaces from the message
      var plotMqtt = [myEpoch, Number(thenum)]; //create the array
      if (isNumber(thenum)) { //check if it is a real number and not text
        console.log('is a propper number, will send to chart.')
        plot(plotMqtt, y);  //send it to the plot function
      };
    };
    //check if a real number
    function isNumber(n) {
      return !isNaN(parseFloat(n)) && isFinite(n);
    };
    //function that is called once the document has loaded
    function init() {
      //i find i have to set this to false if i have trouble with timezones.
      Highcharts.setOptions({
        global: {
          useUTC: false
        }
      });
      // Connect to MQTT broker
      client.connect(options);
    };
    //this adds the plots to the chart
      function plot(point, chartno) {
        console.log(point);

            var series = chart.series[0],
                shift = series.data.length > 20; // shift if the series is
                                                 // longer than 20
            // add the point
            chart.series[chartno].addPoint(point, true, shift);
    };
    //settings for the chart
    $(document).ready(function() {
        chart = new Highcharts.Chart({
            chart: {
                renderTo: 'container',
                defaultSeriesType: 'spline'
            },
            title: {
                text: 'Plotting Live websockets data from a MQTT topic'
            },
            subtitle: {
                                  text: 'broker: ' + MQTTbroker + ' | port: ' + MQTTport + ' | topic : ' + MQTTsubTopic
                          },
            xAxis: {
                type: 'datetime',
                tickPixelInterval: 150,
                maxZoom: 20 * 1000
            },
            yAxis: {
                minPadding: 0.2,
                maxPadding: 0.2,
                title: {
                    text: 'Value',
                    margin: 80
                }
            },
            series: []
        });
    });
</script>

<script src="highstock-7.1.1.js"></script>

<script src="exporting-7.1.1.js"></script>

<div id="container" style="height: 500px; min-width: 500px;"></div>

<script type="text/javascript"> 
init();
</script></div>
        
        
    </div>

    <footer class="col-md-12 text-center">
        
        <hr>
        <p>
        <small>2019 - CieNTi - Euroavia Sevilla<br></small>
        
        <small>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p></small>

        
        
    </footer>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="../../js/bootstrap-3.0.3.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script>
    var base_url = '../..';
    </script>
    <script src="../../js/base.js"></script>
    <script src="../../search/main.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

    </body>

</html>
